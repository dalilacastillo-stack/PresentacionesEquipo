
<app-header></app-header><!--Este es porque no lo encuentra es de el otro proyecto -->
<div class="container text-center">

    <mat-card  style="width: 100%; text-align: center; text-align: -webkit-center;"  >
      <mat-card-title>
        <h1>PROFORMAS  DE EQUIPOS PRESENTADOS</h1>
      </mat-card-title>
      <mat-card-content>
         <!--<mat-tab-group  mat-align-tabs="center"  (selectedTabChange)="cargarPracticasCierre($event)" mat-stretch-tabs class="example-stretched-tabs mat-elevation-z5">
            <mat-tab label = "tab1"> -->
           
              <form [formGroup]="filterForm" (ngSubmit)="Enviar()">
              <div>
                 <!-- Matrícula de login 
                     <mat-form-field  appearance="outline"  style="width: 200px; max-width: 100%; margin-right: 30px;  margin-top: 30px;margin-left: 30px">
                        <mat-label>Matrícula</mat-label>
                         <input matInput type="number" autocomplete="off" formControlName="usuarioSesion"  >
                     </mat-form-field>-->
                           
                 <!-- COMBO DE MATRICULAS (individual y equipo/s)   //   obtenerPlanes(mat,1) el valor 1 es una marca para indicar que se disparo el evento-->
                  <!--<mat-form-field style="width: 300px; max-width: 100%; margin-right: 30px;  margin-top: 30px;margin-left: 30px">
                  <mat-select    (selectionChange)="obtenerPlanes($event); limpiarGrillas()"  placeholder="Seleccione la matricula de cierre " formControlName="matriculaCierre" >
                      <mat-option *ngFor="let mat of listadoMatriculas" [value]="mat.matriculafacturacion">
                       {{mat.matriculafacturacion}}
                      </mat-option>
                 </mat-select>
                </mat-form-field>
               FIN combo matriculas-->
               <!--<button type= "submit"  mat-raised-button color="primary"  [disabled] = ''
                      style="margin-left: 30px; margin-right: 12px; bottom: 5px;"> Filtrar</button> -->
               </div>
                <br> 
             </form>
   
          <!--  <div style="padding: 18px 0 0 420px;text-align: right;">  
                <button mat-raised-button color="primary" type="button" [routerLink]="['/equipos'] " (click)= "Enviar2()" [disabled]="!(dataSource.data)"
                 >Presentar Archivos</button>
            </div>   
            -->        

  <div class="tabla-container">

   <table mat-table [dataSource]="dataSource" class="tabla-sheets">

    <!-- Columna NombrePresentacion -->
    <ng-container matColumnDef="NombrePresentacion">
      <th mat-header-cell *matHeaderCellDef> Presentación </th>
      <td mat-cell *matCellDef="let element">
        <a class="link-archivo"
           (click)="abrirArchivo(element.id,element.nombrePresentacion,element.periodo,element.equipo, element.idEstado)"
           matTooltip="Ver Archivo">
          {{element.nombrePresentacion}}
        </a>
      </td>
    </ng-container>

    <!-- Columna Equipo -->
    <ng-container matColumnDef="Equipo">
      <th mat-header-cell *matHeaderCellDef> Equipo </th>
      <td mat-cell *matCellDef="let element"> {{element.equipo}} </td>
    </ng-container>

    <!-- Columna Periodo -->
    <ng-container matColumnDef="Periodo">
      <th mat-header-cell *matHeaderCellDef> Periodo </th>
      <td mat-cell *matCellDef="let element"> {{element.periodo}} </td>
    </ng-container>

     <!-- Columna Cantidad -->
    <ng-container matColumnDef="Cantidad">
      <th mat-header-cell *matHeaderCellDef> Cantidad de Bonos </th>
      <td mat-cell *matCellDef="let element"> {{element.cantidadRegistros}} </td>
    </ng-container>

    <!-- Columna FechaCarga -->
    <ng-container matColumnDef="FechaCarga">
      <th mat-header-cell *matHeaderCellDef> Fecha de Carga </th>
      <td mat-cell *matCellDef="let element">{{element.fechaCarga | date:'dd-MM-yyyy'}}</td>
    </ng-container>

    <!-- Columna Usuario -->
    <ng-container matColumnDef="Usuario">
      <th mat-header-cell *matHeaderCellDef> Usuario de Carga </th>
      <td mat-cell *matCellDef="let element"> {{element.usuarioCarga}} </td>
    </ng-container>

    <!-- Columna Estado -->
    <ng-container matColumnDef="Estado">
      <th mat-header-cell *matHeaderCellDef> Estado </th>
      <td mat-cell *matCellDef="let element">{{ element.estado }}</td>
    </ng-container>

      <!-- Acciones -->
    <ng-container matColumnDef="Acciones" stickyEnd>
      <th mat-header-cell *matHeaderCellDef> Acciones </th>
      <td mat-cell *matCellDef="let element">

        <button mat-icon-button color="warn"
                [disabled]="element.estado == 'Eliminado' || element.estado == 'Procesado' || element.estado == 'En Proceso' || element.estado == 'Pendiente de IOMA-AMP'"
                title="Eliminar archivo"
                (click)="eliminarArchivoSeleccionado(element); $event.stopPropagation();">
          <mat-icon>delete</mat-icon>
        </button>

        <button mat-icon-button color="warn"
                [disabled]="element.estado == 'Eliminado' || element.estado == 'Cargado' || element.estado == 'En Proceso' || element.estado == 'Pendiente de IOMA-AMP'"
                title="Ver Rechazos"
                (click)="verRechazos(element.id,element.nombrePresentacion, element.equipo,element.idEstado,element.periodo); $event.stopPropagation();">
          <mat-icon>error_outline</mat-icon> <!--preview-->
        </button>

        <button mat-icon-button color="primary"
                *ngIf="perfilUsu"
                [disabled]="element.estado == 'Cargado' || element.estado == 'Eliminado' || element.estado == 'Procesado' || element.estado == 'En Proceso'"
                title="Ver Lotes"
                (click)="consultarLotes(element.id,element.nombrePresentacion, element.equipo,element.idEstado,element.periodo); $event.stopPropagation();">
          <mat-icon>description</mat-icon>
        </button>

        <button mat-icon-button color="primary"
                 *ngIf="perfilUsu"
                [disabled]="element.estado == 'Cargado' || element.estado == 'Eliminado' || element.estado == 'Procesado' || element.estado == 'En Proceso'"
                title="Actualizar"
                (click)="actualizarArchivo(element.id,element.nombrePresentacion, element.equipo,element.idEstado,element.periodo); $event.stopPropagation();">
          <mat-icon>repeat</mat-icon>
        </button>

      </td>
    </ng-container>

    <!-- Filas -->
    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
   </table>

    <!-- Sin datos -->
   <div class="sin-datos" *ngIf="!(dataSource.data.length > 0)">
    <b>No se registran presentaciones</b>
   </div>

   <!-- Paginador -->
   <mat-paginator #paginator [pageSizeOptions]="[5, 10, 25, 100]" showFirstLastButtons></mat-paginator>
  </div>


<!--******************DIALOG DE Eliminación del archivo**************************************************
<ng-template #confirmarEliminarDialog let-data>
    <h2 matDialogTitle><strong>CONFIRMAR ELIMINACIÒN DEL ARCHIVO</strong></h2>
    <hr style="margin-top: 0; margin-bottom: 5px;">
    <mat-dialog-content>
      <strong>Atención: </strong> ¿Confirma la eliminación del archivo?
      <br>
     </mat-dialog-content>
    <mat-dialog-actions align="end">
      <button mat-button matDialogClose>No</button>
      <button mat-raised-button  matDialogClose="yes" >Si</button>
    </mat-dialog-actions>
  </ng-template>

-->


<ng-template #confirmarEliminarDialog>

  <div class="dialog-error">

    <div class="dialog-header-bar"></div>

    <h2 mat-dialog-title class="dialog-title-modern">
      <mat-icon>delete_forever</mat-icon>
      Confirmar eliminación
    </h2>

    <mat-dialog-content class="dialog-content-modern">
      <strong>¿Está seguro que desea eliminar el archivo del equipo presentado?</strong><br>
      Esta acción no se puede deshacer.
    </mat-dialog-content>

    <mat-dialog-actions class="dialog-actions-modern">
      <button mat-button matDialogClose class="btn-cancel-modern">Cancelar</button>
      <button mat-raised-button matDialogClose="yes" class="btn-primary-modern">
        Eliminar
      </button>
    </mat-dialog-actions>

  </div>

</ng-template>



  <!--******************DIALOG DE CONFIRMACION DE ARCHIVO ELIMINADO**************************************************

<ng-template #mensajeEliminadoDialog let-data >
    <h2 matDialogTitle><strong> CONFIRMACIÒN DE ARCHIVO ELIMINADO </strong></h2>
    <hr style="margin-top: 0; margin-bottom: 5px;">
    <mat-dialog-content>
      <h4> 
           <b> El archivo fue eliminado.   </b>
           <br>
           <br>
          
       </h4> 
      <br>
     </mat-dialog-content>
    <mat-dialog-actions align="end">
     
      <button mat-raised-button  matDialogClose="yes" [mat-dialog-close]="codigo">OK</button>
    
    </mat-dialog-actions>
  </ng-template> -->
  

<ng-template #mensajeEliminadoDialog>

  <div class="dialog-success">

    <div class="dialog-header-bar"></div>

    <h2 mat-dialog-title class="dialog-title-modern">
      <mat-icon>check_circle</mat-icon>
      Eliminación exitosa
    </h2>

    <mat-dialog-content class="dialog-content-modern">
      <strong>El registro fue eliminado correctamente.</strong>
    </mat-dialog-content>

    <mat-dialog-actions class="dialog-actions-modern">
      <button mat-raised-button matDialogClose="yes" class="btn-primary-modern">
        OK
      </button>
    </mat-dialog-actions>

  </div>

</ng-template>




 <!--******************DIALOG DE MOSTRAR LOTES**************************************************-->

  <ng-template #mostrarLotesDialog let-data>
    <h2 ><strong>Nros. de Lotes</strong></h2>
    <hr style="margin-top: 0; margin-bottom: 5px;">
    <mat-dialog-content>
      
        <div *ngIf="data && data.length > 0; else noLotes">       
        <div *ngFor="let item of data; let i = index" >
          <h3>Lote #{{ i + 1 }}:  {{ item.nroLote }} </h3>
        </div>
        </div>
        <ng-template #noLibros>
          <p>No hay lotes para mostrar.</p>
        </ng-template>
      
    </mat-dialog-content>
    <mat-dialog-actions align="end">
      <button mat-raised-button  matDialogClose>Cerrar</button>
    </mat-dialog-actions>
  </ng-template>